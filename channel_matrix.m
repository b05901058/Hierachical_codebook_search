function [H] = channel_matrix(N_gnb,N_bs,idx,theta)
%CDL Summary of this function goes here
%   Detailed explanation goes here
%   生成channel matrix
%   H: channel matrix
%   N_ue: UE的antenna數量
%   N_gnb: gNB的antenna數量
%   idx: 選擇A~E的channel model
%   theta: UE及gNB之間的角度


    switch idx
        case "A"
            %三行依序為: power(dB), AoD, AoA
            channel = [-13.4,-178.1,51.3;
                       0,-4.2,-152.7;
                       -2.2,-4.2,-152.7;
                       -4,-4.2,-152.7;
                       -6,90.2,76.6;
                       -8.2,90.2,76.6;
                       -9.9,90.2,76.6;
                       -10.5,121.5,-1.8;
                       -7.5,-81.7,-41.9;
                       -15.9,158.4,94.2;
                       -6.6,-83,51.9;
                       -16.7,134.8,-115.9;
                       -12.4,-153,26.6;
                       -15.2,-172,76.6;
                       -10.8,-129.9,-7;
                       -11.3,-136,-23;
                       -12.7,165.4,-47.2;
                       -16.2,148.4,110.4;
                       -18.3,132.7,114.5;
                       -18.9,-118.6,155.3;
                       -16.6,-154.1,102;
                       -19.9,126.5,-151.8;
                       -29.7,-56.2,55.2];
        case "B"
            channel = [0,9.3,-173.3;
                       -2.2,9.3,-173.3;
                       -4,9.3,-173.3;
                       -3.2,-34.1,125.5;
                       -9.8,-65.4,-88;
                       -1.2,-11.4,155.1;
                       -3.4,-11.4,155.1
                       -5.2,-11.4,155.1;
                       -7.6,-67.2,-89.8;
                       -3,52.5,132.1;
                       -8.9,-72,-83.6;
                       -9,74.3,95.3;
                       -4.8,-52.2,103.7;
                       -5.7,-50.5,-87.8;
                       -7.5,61.4,-92.5;
                       -1.9,30.6,-139.1;
                       -7.6,-72.5,-90.6;
                       -12.2,-90.6,58.6;
                       -9.8,-77.6,-79;
                       -11.4,-82.6,65.8;
                       -14.9,-103.6,52.7;
                       -9.2,75.6,88.7;
                       -11.3,-77.6,-60.4];
        case "C"
            channel = [-4.4,-46.6,-101;
                       -1.2,-22.8,120;
                       -3.5,-22.8,120;
                       -5.2,-22.8,120;
                       -2.5,-40.7,-127.5;
                       0,0.3,170.4;
                       -2.2,0.3,170.4;
                       -3.9,0.3,170.4;
                       -7.4,73.1,55.4;
                       -7.1,-64.5,66.5;
                       -10.7,80.2,-48.1;
                       -11.1,-97.1,64.9;
                       -5.1,-55.3,68.1;
                       -6.8,-64.3,-68.7;
                       -8.7,-78.5,81.5;
                       -13.2,102.7,30.7;
                       -13.9,99.2,-16.4;
                       -13.9,88.8,3.8;
                       -15.8,-101.9,-13.7;
                       -17.1,92.2,9.7;
                       -16,93.3,5.6;
                       -15.7,106.6,0.7;
                       -21.6,119.5,-21.9;
                       -22.8,-123.8,33.6];
        case "D"
            channel = [-0.2,0,-180;
                       -13.5,0,-180;
                       -18.8,89.2,89.2;
                       -21,98.2,98.2;
                       -22.8,98.2,98.2;
                       -17.9,13,163;
                       -20.1,13,163;
                       -21.9,13,163;
                       -22.9,34.6,-137;
                       -27.8,-64.5,74.5;
                       -23.6,-32.9,127.7;
                       -24.8,52.6,-119.6;
                       -30,-132.1,-9.1;
                       -27.7,77.2,-83.8];
        case "E"
            channel = [-0.03,0,-180;
                       -22.03,0,-180;
                       -15.8,57.5,18.2;
                       -18.1,57.5,18.2;
                       -19.8,57.5,18.2;
                       -22.9,-20.1,101.8;
                       -22.4,16.2,112.9;
                       -18.6,9.3,-155.5;
                       -20.8,9.3,-155.5;
                       -22.6,9.3,-115.5;
                       -22.3,19,-143.3;
                       -25.6,32.7,-94.7;
                       -20.2,0.5,147;
                       -29.8,55.9,-36.2;
                       -29.2,57.6,-26];
    end
    H = zeros(N_gnb,N_bs);
    for j = 1:size(channel,1)
        angle = mod(channel(j,3)-theta,360);
        if angle>180
            angle = angle-360;
        end
        if abs(angle)>90
            angle = -angle;
        end
        aoa = (0:(N_gnb-1))*angle*2;
        aoa = aoa*i*pi/180;
        angle = mod(channel(j,2)-theta,360);
        if angle>180
            angle = angle-360;
        end
        if abs(angle)>90
            angle = -angle;
        end
        aod = (0:(N_bs-1))*angle*2;
        aod = aod*i*pi/180;
        H = H + 10^channel(j,1) * exp(aoa') * exp(aod);
    end
end

